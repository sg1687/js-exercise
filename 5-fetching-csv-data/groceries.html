<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Groceries (CSV)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        li {
            margin-bottom: 6px;
        }
    </style>
</head>
<body>

    <h1>Groceries (CSV)</h1>
    <a href="../index.html">Home</a>

    <h2>Dataset Information</h2>
    <p>For this exercise, we will use a CSV file called
        <a href="https://raw.githubusercontent.com/prof-rossetti/intro-to-python/main/data/products.csv">"products.csv"</a>
        that has been uploaded to the Internet.
        The CSV file contains an inventory of grocery store products.
        This data was adapted from an open source dataset provided by Instacart in 2017.
    </p>

    <h2>Part 1</h2>
    <p>
        Write JavaScript code to answer the questions below.
        Log each of the answers to the console.
    </p>

    <h2>Part 2</h2>
    <p>
        Display the answers on the page in the designated areas:
    </p>

    <hr>
    <h2>Display</h2>
    <p>Groceries:</p>
    <ul id="display-groceries"></ul>

    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <script type="text/javascript">

        function formatUSD(price) {
            return `$${parseFloat(price).toFixed(2)}`;
        }

        const requestUrl = "https://raw.githubusercontent.com/prof-rossetti/intro-to-python/main/data/products.csv";

        d3.csv(requestUrl).then(function(data) {
            console.log("DATA:", data);
            const products = data.filter(p => p.id); // Remove any blank rows

            console.log("---------------------");
            console.log("PART 1...");

            // A. Total number of products
            console.log("Number of products:", products.length); // Should be 20

            // B. Name and price of each
            products.forEach(product => {
                console.log(`${product.name}: ${formatUSD(product.price)}`);
            });

            // C. Unique departments
            const departments = [];
            products.forEach(product => {
                if (!departments.includes(product.department)) {
                    departments.push(product.department);
                }
            });

            console.log("Unique departments:", departments);
            console.log("Number of unique departments:", departments.length); // Should be 10

            // D. Departments uppercased
            departments.forEach(dept => {
                console.log(dept.toUpperCase());
            });

            // E. Filter for beverages
            const beverages = products.filter(p => p.department.toLowerCase() === "beverages");
            console.log("Number of beverage products:", beverages.length); // Should be 5

            // F. Average beverage price
            const totalBeveragePrice = d3.sum(beverages, d => parseFloat(d.price));
            const avgBeveragePrice = totalBeveragePrice / beverages.length;
            console.log("Average beverage price:", formatUSD(avgBeveragePrice)); // Should be ~$3.04

            console.log("---------------------");
            console.log("PART 2...");

            // A. Sort products by name ascending
            const sortedProducts = [...products].sort((a, b) => a.name.localeCompare(b.name));

            // B. Display in ul
            const ul = document.getElementById("display-groceries");
            sortedProducts.forEach(product => {
                const li = document.createElement("li");
                li.textContent = `${product.name}: ${formatUSD(product.price)}`;
                ul.appendChild(li);
            });

        }).catch(function(error) {
            console.error("ERROR:", error);
        });

    </script>
</body>
</html>